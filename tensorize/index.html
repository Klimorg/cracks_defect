
<!doctype html>
<html lang="fr" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <meta name="author" content="Mathieu Klimczak">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>Transformation des données - Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipeline-pour-la-transformation-des-donnees" class="md-skip">
          Aller au contenu
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Documentation" class="md-header-nav__button md-logo" aria-label="Documentation">
      
  <img src="../images/logo_blanc.svg" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            Documentation
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Transformation des données
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Rechercher" placeholder="Rechercher" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      Acceuil
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../make_dataset/" class="md-tabs__link md-tabs__link--active">
        Création des datasets
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../resnet/" class="md-tabs__link">
        Modèles CNN
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../train/" class="md-tabs__link">
      Boucle d'entraînement
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../test_tensorize/" class="md-tabs__link">
        Tests unitaires
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Documentation" class="md-nav__button md-logo" aria-label="Documentation">
      
  <img src="../images/logo_blanc.svg" alt="logo">

    </a>
    Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Acceuil
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
      
      <label class="md-nav__link" for="nav-2">
        Création des datasets
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Création des datasets" data-md-level="1">
        <label class="md-nav__title" for="nav-2">
          <span class="md-nav__icon md-icon"></span>
          Création des datasets
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../make_dataset/" class="md-nav__link">
        Initialisation
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Transformation des données
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Transformation des données
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.tensorize" class="md-nav__link">
    src.tensorize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize" class="md-nav__link">
    Tensorize
  </a>
  
    <nav class="md-nav" aria-label="Tensorize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.create_dataset" class="md-nav__link">
    create_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.load_images" class="md-nav__link">
    load_images()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.load_labels" class="md-nav__link">
    load_labels()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.parse_image_and_label" class="md-nav__link">
    parse_image_and_label()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.train_preprocess" class="md-nav__link">
    train_preprocess()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        Modèles CNN
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Modèles CNN" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          Modèles CNN
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../resnet/" class="md-nav__link">
        Architecture ResNet
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../train/" class="md-nav__link">
        Boucle d'entraînement
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
      
      <label class="md-nav__link" for="nav-5">
        Tests unitaires
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tests unitaires" data-md-level="1">
        <label class="md-nav__title" for="nav-5">
          <span class="md-nav__icon md-icon"></span>
          Tests unitaires
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../test_tensorize/" class="md-nav__link">
        tensorize
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../test_make_dataset/" class="md-nav__link">
        prepare_dataset
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../test_utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table des matières">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table des matières
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.tensorize" class="md-nav__link">
    src.tensorize
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize" class="md-nav__link">
    Tensorize
  </a>
  
    <nav class="md-nav" aria-label="Tensorize">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.create_dataset" class="md-nav__link">
    create_dataset()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.load_images" class="md-nav__link">
    load_images()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.load_labels" class="md-nav__link">
    load_labels()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.parse_image_and_label" class="md-nav__link">
    parse_image_and_label()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.tensorize.Tensorize.train_preprocess" class="md-nav__link">
    train_preprocess()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="pipeline-pour-la-transformation-des-donnees">Pipeline pour la transformation des données</h1>
<div class="doc doc-object doc-module">
<h2 class="hidden-toc" id="src.tensorize" style="visibility: hidden; position: absolute;">
        </h2>
<div class="doc doc-contents first">
<div class="doc doc-children">
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="src.tensorize.Tensorize">

        <code>Tensorize</code>



      </h2>
<div class="doc doc-contents ">
<p>Class used to create tensor datasets for TensorFlow.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>object</code></td>
<td><code>object</code></td>
<td>
<p>The base class of the class hierarchy, used only to enforce
WPS306. See https://wemake-python-stylegui.de/en/latest/pages/usage/
violations/consistency.html#consistency.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<div class="doc doc-children">
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="src.tensorize.Tensorize.__init__">

<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">,</span> <span class="n">img_shape</span><span class="p">,</span> <span class="n">random_seed</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

      </h3>
<div class="doc doc-contents ">
<p>Initialization of the class Featurize.</p>
<p>Initialize the class the number of classes in the datasets, the shape of the
images and the random seed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>n_classes</code></td>
<td><code>int</code></td>
<td>
<p>Number of classes in the dataset.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>img_shape</code></td>
<td><code>Tuple[int, int, int]</code></td>
<td>
<p>Dimension of the image, format is (H,W,C).</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>random_seed</code></td>
<td><code>int</code></td>
<td>
<p>Fixed random seed for reproducibility.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>src/tensorize.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">n_classes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">img_shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">random_seed</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Initialization of the class Featurize.</span>

<span class="sd">    Initialize the class the number of classes in the datasets, the shape of the</span>
<span class="sd">    images and the random seed.</span>

<span class="sd">    Args:</span>
<span class="sd">        n_classes (int): Number of classes in the dataset.</span>
<span class="sd">        img_shape (Tuple[int, int, int]): Dimension of the image, format is (H,W,C).</span>
<span class="sd">        random_seed (int): Fixed random seed for reproducibility.</span>
<span class="sd">    """</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span> <span class="o">=</span> <span class="n">n_classes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">img_shape</span> <span class="o">=</span> <span class="n">img_shape</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">random_seed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">AUTOTUNE</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">experimental</span><span class="o">.</span><span class="n">AUTOTUNE</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="src.tensorize.Tensorize.create_dataset">

<code class="highlight language-python"><span class="n">create_dataset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_path</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">repet</span><span class="p">,</span> <span class="n">prefetch</span><span class="p">,</span> <span class="n">augment</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Creation of a tensor dataset for TensorFlow.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_path</code></td>
<td><code>str</code></td>
<td>
<p>Path where the csv file containing the dataframe is
located.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>batch</code></td>
<td><code>int</code></td>
<td>
<p>Batch size, usually 32.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>repet</code></td>
<td><code>int</code></td>
<td>
<p>How many times the dataset has to be repeated.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>prefetch</code></td>
<td><code>int</code></td>
<td>
<p>How many batch the CPU has to prepare in advance for the
GPU.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>augment</code></td>
<td><code>bool</code></td>
<td>
<p>Does the dataset has to be augmented or no.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DatasetV2</code></td>
<td>
<p>A batch of observations and labels.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>src/tensorize.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">batch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">repet</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">prefetch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">augment</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
    <span class="sd">"""Creation of a tensor dataset for TensorFlow.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_path (str): Path where the csv file containing the dataframe is</span>
<span class="sd">            located.</span>
<span class="sd">        batch (int): Batch size, usually 32.</span>
<span class="sd">        repet (int): How many times the dataset has to be repeated.</span>
<span class="sd">        prefetch (int): How many batch the CPU has to prepare in advance for the</span>
<span class="sd">            GPU.</span>
<span class="sd">        augment (bool): Does the dataset has to be augmented or no.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A batch of observations and labels.</span>
<span class="sd">    """</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_images</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">column_name</span><span class="o">=</span><span class="s2">"filename"</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_labels</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">column_name</span><span class="o">=</span><span class="s2">"label"</span><span class="p">)</span>

    <span class="n">dataset</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="n">from_tensor_slices</span><span class="p">((</span><span class="n">features</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">),</span> <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">repet</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parse_image_and_label</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTOTUNE</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">augment</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">map</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">train_preprocess</span><span class="p">,</span> <span class="n">num_parallel_calls</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AUTOTUNE</span>
        <span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">batch</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">cache</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">dataset</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="n">prefetch</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="src.tensorize.Tensorize.load_images">

<code class="highlight language-python"><span class="n">load_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load the images as a list.</p>
<p>Take the dataframe containing the observations and the labels and the return the
column containing the observations as a list.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_frame</code></td>
<td><code>DataFrame</code></td>
<td>
<p>Dataframe containing the dataset.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>column_name</code></td>
<td><code>str</code></td>
<td>
<p>The name of the column containing the observations.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>List[str]</code></td>
<td>
<p>The list of observations deduced from the dataframe.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>src/tensorize.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_images</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
    <span class="sd">"""Load the images as a list.</span>

<span class="sd">    Take the dataframe containing the observations and the labels and the return the</span>
<span class="sd">    column containing the observations as a list.</span>

<span class="sd">    Args:</span>
<span class="sd">        data_frame (pd.DataFrame): Dataframe containing the dataset.</span>
<span class="sd">        column_name (str): The name of the column containing the observations.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of observations deduced from the dataframe.</span>
<span class="sd">    """</span>
    <span class="k">return</span> <span class="n">data_frame</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="src.tensorize.Tensorize.load_labels">

<code class="highlight language-python"><span class="n">load_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">,</span> <span class="n">column_name</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Load the labels as a list and encode them.</p>
<p>Take the dataframe containing the observations and the labels and the return the
column containing the labels as an encoded list.</p>
<p>The encoding is done by taking the set of labels, alphabetically sorted, and
then transforming them as integers starting from 0.</p>
<p><code>from sklearn.preprocessing import LabelEncoder</code> works well to encode labels,
but if the dataset is huge, the time it takes to encode all the labels is
growing fast. We use anumpy and vectorization to speed up the time.</p>
<p>See the StackOverflow question :
<a href="https://stackoverflow.com/questions/45321999/ how-can-i-optimize-label-encoding-for-large-data-sets-sci-kit-learn">Question</a></p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_frame</code></td>
<td><code>DataFrame</code></td>
<td>
<p>Dataframe containing the dataset.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>column_name</code></td>
<td><code>str</code></td>
<td>
<p>The name of the column containing the labels.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>List[int]</code></td>
<td>
<p>The list of encoded labels deduced from the dataframe.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>src/tensorize.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">load_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_frame</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
    <span class="sd">"""Load the labels as a list and encode them.</span>

<span class="sd">    Take the dataframe containing the observations and the labels and the return the</span>
<span class="sd">    column containing the labels as an encoded list.</span>

<span class="sd">    The encoding is done by taking the set of labels, alphabetically sorted, and</span>
<span class="sd">    then transforming them as integers starting from 0.</span>

<span class="sd">    `from sklearn.preprocessing import LabelEncoder` works well to encode labels,</span>
<span class="sd">    but if the dataset is huge, the time it takes to encode all the labels is</span>
<span class="sd">    growing fast. We use anumpy and vectorization to speed up the time.</span>

<span class="sd">    See the StackOverflow question :</span>
<span class="sd">    [Question](https://stackoverflow.com/questions/45321999/</span>
<span class="sd">    how-can-i-optimize-label-encoding-for-large-data-sets-sci-kit-learn)</span>

<span class="sd">    Args:</span>
<span class="sd">        data_frame (pd.DataFrame): Dataframe containing the dataset.</span>
<span class="sd">        column_name (str): The name of the column containing the labels.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The list of encoded labels deduced from the dataframe.</span>
<span class="sd">    """</span>
    <span class="n">label_list</span> <span class="o">=</span> <span class="n">data_frame</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">label_list</span><span class="p">))</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Found following labels </span><span class="si">{</span><span class="n">classes</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
    <span class="n">dic</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">label_list</span><span class="p">,</span> <span class="n">labels</span><span class="p">))</span>  <span class="c1"># type: Dict[str, int]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Dictionnary creation </span><span class="si">{</span><span class="n">dic</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">vectorized_get</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">dic</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="k">return</span> <span class="n">vectorized_get</span><span class="p">(</span><span class="n">label_list</span><span class="p">)</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="src.tensorize.Tensorize.parse_image_and_label">

<code class="highlight language-python"><span class="n">parse_image_and_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Transform image and label.</p>
<p>Parse image to go from path to a resized np.ndarray, and parse the labels to
one-hot encode them.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>filename</code></td>
<td><code>str</code></td>
<td>
<p>The path of the image to parse.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>label</code></td>
<td><code>int</code></td>
<td>
<p>The label of the image, as an int, to one-hot encode.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Tuple[numpy.ndarray, int]</code></td>
<td>
<p>A np.ndarray corresponding to the image and the corresponding one-hot label.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>src/tensorize.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">parse_image_and_label</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">int</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
    <span class="sd">"""Transform image and label.</span>

<span class="sd">    Parse image to go from path to a resized np.ndarray, and parse the labels to</span>
<span class="sd">    one-hot encode them.</span>

<span class="sd">    Args:</span>
<span class="sd">        filename (str): The path of the image to parse.</span>
<span class="sd">        label (int): The label of the image, as an int, to one-hot encode.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A np.ndarray corresponding to the image and the corresponding one-hot label.</span>
<span class="sd">    """</span>
    <span class="n">resized_dims</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">img_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">img_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="c1"># convert the label to one-hot encoding</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_classes</span><span class="p">)</span>
    <span class="c1"># decode image</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="c1"># Don't use tf.image.decode_image,</span>
    <span class="c1"># or the output shape will be undefined</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">decode_jpeg</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="c1"># This will convert to float values in [0, 1]</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">convert_image_dtype</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">resized_dims</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span>
</code></pre>
</div>
</details>
</div>
</div>
<div class="doc doc-object doc-method">
<h3 class="doc doc-heading" id="src.tensorize.Tensorize.train_preprocess">

<code class="highlight language-python"><span class="n">train_preprocess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span></code>


      </h3>
<div class="doc doc-contents ">
<p>Augmentation preprocess, if needed.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>image</code></td>
<td><code>ndarray</code></td>
<td>
<p>The image to augment.</p>
</td>
<td><em>required</em></td>
</tr>
<tr>
<td><code>label</code></td>
<td><code>List[int]</code></td>
<td>
<p>The corresponding label.</p>
</td>
<td><em>required</em></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Tuple[numpy.ndarray, List[int]]</code></td>
<td>
<p>The augmented pair.</p>
</td>
</tr>
</tbody>
</table>
<details class="quote">
          <summary>Source code in <code>src/tensorize.py</code></summary>
          <div class="highlight">
<pre><span></span><code><span class="k">def</span> <span class="nf">train_preprocess</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">image</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>  <span class="c1"># type: ignore</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>  <span class="c1"># type: ignore</span>
    <span class="sd">"""Augmentation preprocess, if needed.</span>

<span class="sd">    Args:</span>
<span class="sd">        image (np.ndarray): The image to augment.</span>
<span class="sd">        label (List[int]): The corresponding label.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The augmented pair.</span>
<span class="sd">    """</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">random_flip_left_right</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">random_flip_up_down</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">image</span><span class="p">,</span> <span class="n">label</span>
</code></pre>
</div>
</details>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../make_dataset/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Précédent
                </span>
                Initialisation
              </div>
            </div>
          </a>
        
        
          <a href="../resnet/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Suivant
                </span>
                Architecture ResNet
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="../assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copier dans le presse-papier", "clipboard.copied": "Copi\u00e9 dans le presse-papier", "search.config.lang": "fr", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Rechercher", "search.result.placeholder": "Taper pour d\u00e9marrer la recherche", "search.result.none": "Aucun document trouv\u00e9", "search.result.one": "1 document trouv\u00e9", "search.result.other": "# documents trouv\u00e9s", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['navigation.instant', 'navigation.tabs'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../javascripts/config.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>